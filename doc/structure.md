# 程序结构与执行逻辑

## 1. 程序文件结构

*   **`index.html`**: 程序的入口文件。定义了页面的整体布局，包括左侧的配置面板（Sidebar）和右侧的预览区域（Preview Area）。引入了必要的外部库（如 `html2canvas`, `cropperjs`, `color-thief`）以及本地的样式表和脚本。
*   **`style.css`**: 定义了程序的样式。包括界面的布局（Flexbox/Grid）、组件样式（滑块、按钮）、以及核心的视觉效果（如墨点背景的渐变动画、玻璃拟态效果）。
*   **`script.js`**: 包含程序的核心逻辑。负责处理用户交互、DOM 操作、状态管理（设置保存/读取）、图片处理（裁剪、颜色提取）、以及背景渲染逻辑。
*   **`start_server.py`**: 一个简单的 Python 脚本，用于启动本地 HTTP 服务器，以便在浏览器中预览和运行程序。

## 2. 启动后的执行逻辑

当用户在浏览器中打开 `index.html` 后，程序的初始化流程如下：

1.  **加载资源**: 浏览器加载 HTML 结构，并按顺序加载 CSS 样式表和 JavaScript 脚本库。
2.  **DOM 就绪 (`DOMContentLoaded`)**: `script.js` 中的主逻辑开始执行。
    *   **初始化引用**: 获取页面上所有关键 DOM 元素的引用（输入框、按钮、显示区域等）。
    *   **字体检测**: 异步检测用户系统中可用的字体，并填充到字体选择下拉菜单中。
    *   **加载设置**: 从 `localStorage` 中读取用户保存的配置（`saltPlayerSettings`）。如果不存在，则使用默认配置。
    *   **初始化显示**: 更新时间显示 (`updateTimeDisplay`)。
    *   **设置初始模式**: 调用 `setMode('player')` 将界面初始化为“播放器模式”。这会设置预览区域的尺寸，并显示相应的 DOM 元素。
    *   **调整缩放**: 调用 `updatePreviewScale()`，根据当前窗口大小和预览区域尺寸，计算并应用 CSS `scale` 变换，确保预览卡片完整显示在屏幕上。
    *   **设置默认封面**: 如果没有上传封面，生成一个默认的灰色占位图。
    *   **渲染背景**:

## 3. 最终呈现效果

程序启动并初始化完成后，用户将看到以下界面：

*   **左侧配置面板**:
    *   提供文件上传控件（封面、音频）。
    *   提供文本输入框（标题、歌手、歌词、评价）。
    *   提供各种样式调整滑块（尺寸、字体大小、间距、圆角等）。
    *   提供功能开关（显示/隐藏歌词、进度条、背景模糊等）。
*   **右侧预览区域**:
    *   居中显示一个模拟的音乐播放器卡片。
    *   **背景**: 呈现动态生成的浅色“墨点”效果或者暗色模糊背景，对应两种模式。
    *   **内容**: 显示专辑封面、歌曲信息、滚动歌词、进度条和播放控制按钮。
    *   **交互**: 用户在左侧修改配置时，右侧预览会实时更新。用户还可以拖拽卡片内的元素来自定义布局。
  ## 4. 3840x2160 分辨率下的三种模式理想排版格式

以下是针对 3840x2160 (4K Landscape) 分辨率优化的三种模式（播放器、评价、横屏）的理想排版配置。

这些配置可以直接替换 `script.js` 中的 `defaultSettings` 对象，或者手动在程序界面中调整并保存。